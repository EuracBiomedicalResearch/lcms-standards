---
title: "Counting the number of C, H, N, O, P, S for compounds in HMDB"
author: "Andrea Vicini, Johannes Rainer"
output:
  rmarkdown::html_document:
    highlight: pygments
    toc: true
    toc_depth: 3
    fig_width: 5
---

```{r style, echo = FALSE, results = 'asis', message = FALSE}
library(BiocStyle)
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
```

**Last modified:** `r file.info("CHNOPSinHMDB.Rmd")$mtime`<br />
**Compiled**: `r date()`


```{r libraries, warning = FALSE}
library("CompoundDb")
library("MetaboCoreUtils")
library("pander")
```

We load the HMDB database and extract the related compounds.

```{r}
cdb <- CompDb("~/CompDb.Hsapiens.HMDB.4.0.sqlite")
cmps <- compounds(cdb, columns = c("compound_id", "name", "formula", "exactmass"))
```

For each compound in the human metabolom database (HMDB) we compute how many 
atoms of C, H, N, O, P and S are present in it. 
We collect the counts in a data frame with a column for each element and a row 
for each compound in HMDB.

```{r}
CHNOPS <- c("C", "H", "N", "O", "P", "S")
counts <- lapply(cmps$formula, function(frml) {
  res <- countElements(frml)
  row <- data.frame(matrix(0, nrow = 1, ncol = length(CHNOPS)))
  names(row) <- CHNOPS
  only <- intersect(CHNOPS, names(res))
  row[1, only] <- res[only]
  row
  })
counts_df <- do.call(rbind, counts)
rownames(counts_df) <- cmps$compound_id
```

We compute the mean and standard deviation for the number of each element in the 
molecules of HMDB.

```{r}
m_sd <- rbind(colMeans(counts_df), apply(counts_df, 2, sd))
rownames(m_sd) = c("mean", "standard deviation")
pandoc.table(m_sd, style = "rmarkdown")
```

We plot, for each of the considered elements,the distribution of the number of 
atoms of the given element in the compounds of HMDB.

```{r distribution-counts, fig.cap = "distribution of the number of atoms of CHNOPS element in the compounds of HMDB.", fig.width = 7, fig.height = 12}
par(mfrow = c(6,1))
for (el in CHNOPS)
{
  barplot(table(counts_df[, el]), xlab = paste0("Number of counted ", el),
          ylab = "Number of compounds")
}
# It's not clear to me why particularly for H the number of compounds  
# oscillates between odd and even numbers or almost seems like 
# there are two different behaviours
```


# Session information

The R version and packages used in this analysis are listed below.

```{r sessioninfo}
sessionInfo()
```
